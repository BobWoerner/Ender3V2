#####################################################################
#   Printer & MCU
#####################################################################

[printer]
kinematics: cartesian
max_velocity: 300
max_accel: 5000
max_z_velocity: 15
max_z_accel: 300
square_corner_velocity: 10

[mcu]
serial: /dev/serial/by-id/usb-Klipper_stm32g0b1xx_4C00310019504B5735313920-if00

[virtual_sdcard]
path: /home/pi/printer_data/gcodes
on_error_gcode: CANCEL_PRINT

[board_pins]
aliases:
    # EXP1 header
    EXP1_1=PB5,  EXP1_3=PA9,   EXP1_5=PA10, EXP1_7=PB8, EXP1_9=<GND>,
    EXP1_2=PA15, EXP1_4=<RST>, EXP1_6=PB9,  EXP1_8=PD6, EXP1_10=<5V>

[include mainsail.cfg]
[include  macros.cfg]
#[include adxl.cfg]
[include KAMP_Settings.cfg]
[include nozzle_clean.cfg]
[include GIT backup.cfg]
[include shell_command.cfg]

[input_shaper]
shaper_type_x: ei
shaper_freq_x: 58.2  # frequency for the X mark of the test model
shaper_type_y: ei
shaper_freq_y: 39.8 # frequency for the Y mark of the test model

#####################################################################
#   X Stepper Settings
#####################################################################

[stepper_x]
step_pin: PB13
dir_pin: !PB12
enable_pin: !PB14
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC0
position_endstop: 0
position_max: 256
homing_speed: 50

[tmc2209 stepper_x]
uart_pin: PC11
tx_pin: PC10
uart_address: 0
run_current: 0.650
stealthchop_threshold: 999999

#####################################################################
#   Y Stepper Settings
#####################################################################

[stepper_y]
step_pin: PB10
dir_pin: !PB2
enable_pin: !PB11
microsteps: 16
rotation_distance: 40
endstop_pin: ^PC1
position_endstop: 0
position_max: 236
homing_speed: 50

[tmc2209 stepper_y]
uart_pin: PC11
tx_pin: PC10
uart_address: 2
run_current: 0.650
stealthchop_threshold: 999999

#####################################################################
#   Z Stepper Settings
#####################################################################

[stepper_z]
step_pin: PB0
dir_pin: PC5
enable_pin: !PB1
microsteps: 16
rotation_distance: 39.84
gear_ratio: 80:16
endstop_pin: probe:z_virtual_endstop # use beacon as virtual endstop
homing_retract_dist: 0 # beacon needs this to be set to 0
position_max: 245
position_min: -10

[tmc2209 stepper_z]
uart_pin: PC11
tx_pin: PC10
uart_address: 1
run_current: 0.580
stealthchop_threshold: 999999

#####################################################################
#   Extruder
#####################################################################

[extruder]
step_pin: PB3
dir_pin: PB4
enable_pin: !PD1
microsteps: 16
rotation_distance: 5.7
nozzle_diameter: 0.400
filament_diameter: 1.750
heater_pin: PC8
sensor_type: Trianglelab NTC100K B3950
sensor_pin: PA0
#control: pid
#pid_Kp: 21.527
#pid_Ki: 1.063
#pid_Kd: 108.982
min_temp: 0
max_temp: 300
max_extrude_only_distance: 101
max_extrude_cross_section: 5
pressure_advance: 0.048

[tmc2209 extruder]
uart_pin: PC11
tx_pin: PC10
uart_address: 3
run_current: 0.5
stealthchop_threshold: 999999

#####################################################################
#   Bed Heater
#####################################################################

[heater_bed]
heater_pin: PC9
sensor_type: ATC Semitec 104GT-2
sensor_pin: PC4
#control: pid
#pid_Kp: 54.027
#pid_Ki: 0.770
#pid_Kd: 948.182
min_temp: 0
max_temp: 130

#####################################################################
#   Homing and Gantry Adjustment Routines
#####################################################################

[bed_mesh]
speed: 200
horizontal_move_z: 2
mesh_min: 10, 10
mesh_max: 210, 210
zero_reference_position: 112, 115.5
probe_count: 15, 15
algorithm: bicubic
fade_start: 1
fade_end: 10
fade_target: 0

[beacon]
serial: /dev/serial/by-id/usb-Beacon_Beacon_RevD_A9E01BE04E5737374D202020FF10310F-if00
default_model_name: default #   Name of default beacon model to load.
x_offset: -30 # update with offset from nozzle on your machine
y_offset: 0 # update with offset from nozzle on your machine
mesh_main_direction: x
mesh_runs: 2

[safe_z_home]
home_xy_position: 112, 115.5 # Change coordinates to the center of your print bed
z_hop: 5                 # Move up 10mm z_hop_speed: 5

[screws_tilt_adjust]
screw1: 56, 28
screw1_name: Front left
screw2: 227, 28
screw2_name: Front right
screw3: 227, 199
screw3_name: Back right
screw4: 56, 199
screw4_name: Back left
screw_thread: CW-M4
horizontal_move_z: 5

#####################################################################
#   Fan & Sensors
#####################################################################

[thermistor Trianglelab NTC100K B3950]
## values calibrated against a PT100 reference
temperature1: 25.0
resistance1: 103180.0
temperature2: 150.0
resistance2: 1366.2
temperature3: 250.0
resistance3: 168.6

[temperature_sensor raspberry_pi]
sensor_type: temperature_host
min_temp: 0
max_temp: 100

[temperature_sensor MCU_temp]
sensor_type: temperature_mcu
min_temp: 0
max_temp: 100

[heater_fan heatbreak_cooling_fan]
pin: PC7

[heater_fan controller_fan]
pin: PB15

[fan]
pin: PC6

;[filament_switch_sensor RunoutSensor]
;pause_on_runout: False
;runout_gcode: PAUSE
;insert_gcode: RESUME
;switch_pin: !PC15

#####################################################################
#   Added for Orca Slicer
#####################################################################

# Enable object exclusion
[exclude_object]

# Enable arcs support
[gcode_arcs]
resolution: 0.1

#*# <---------------------- SAVE_CONFIG ---------------------->
#*# DO NOT EDIT THIS BLOCK OR BELOW. The contents are auto-generated.
#*#
#*# [extruder]
#*# control = pid
#*# pid_kp = 17.286
#*# pid_ki = 0.707
#*# pid_kd = 105.660
#*#
#*# [heater_bed]
#*# control = pid
#*# pid_kp = 67.240
#*# pid_ki = 1.065
#*# pid_kd = 1061.547
#*#
#*# [bed_mesh default]
#*# version = 1
#*# points =
#*# 	  -0.149790, -0.139610, -0.137923, -0.135804, -0.121123, -0.105670, -0.099099, -0.097556, -0.103757, -0.106924, -0.111608, -0.139092, -0.142144, -0.129099, -0.117542
#*# 	  -0.116201, -0.100791, -0.094681, -0.092074, -0.082918, -0.083745, -0.078624, -0.080897, -0.087369, -0.089253, -0.095919, -0.102665, -0.114815, -0.105235, -0.098968
#*# 	  -0.109914, -0.085321, -0.080942, -0.071767, -0.066321, -0.064447, -0.060521, -0.062316, -0.066919, -0.073548, -0.076793, -0.089104, -0.096417, -0.095279, -0.089659
#*# 	  -0.091015, -0.066783, -0.059687, -0.055599, -0.049580, -0.046194, -0.042084, -0.043858, -0.050097, -0.056330, -0.059979, -0.071537, -0.081063, -0.079763, -0.084565
#*# 	  -0.074631, -0.047560, -0.040021, -0.036927, -0.030683, -0.026544, -0.021919, -0.023277, -0.032892, -0.038537, -0.042254, -0.051439, -0.060770, -0.061469, -0.065119
#*# 	  -0.059528, -0.032397, -0.024977, -0.021319, -0.015711, -0.011559, -0.007774, -0.007403, -0.017522, -0.022887, -0.025057, -0.035952, -0.043726, -0.043866, -0.048159
#*# 	  -0.052121, -0.023220, -0.013518, -0.009789, -0.005528, -0.001749, 0.000949, 0.002153, -0.004403, -0.007731, -0.011261, -0.020516, -0.028433, -0.031818, -0.034416
#*# 	  -0.051261, -0.017016, -0.008381, -0.006975, -0.005292, -0.002778, 0.001889, 0.003516, -0.000911, -0.002933, -0.004027, -0.012762, -0.025567, -0.024557, -0.029500
#*# 	  -0.057115, -0.022396, -0.012026, -0.010824, -0.009557, -0.011722, -0.006893, -0.001785, -0.003785, -0.008695, -0.007298, -0.015003, -0.022444, -0.025220, -0.034372
#*# 	  -0.062781, -0.033794, -0.024706, -0.022191, -0.019645, -0.018948, -0.014034, -0.009718, -0.012784, -0.019676, -0.016396, -0.024528, -0.029117, -0.031198, -0.037863
#*# 	  -0.071974, -0.045031, -0.035521, -0.031089, -0.030478, -0.027319, -0.021323, -0.019620, -0.023734, -0.027398, -0.028690, -0.032410, -0.038828, -0.038476, -0.044657
#*# 	  -0.082128, -0.060539, -0.054136, -0.048091, -0.048077, -0.044193, -0.035628, -0.034693, -0.036226, -0.038220, -0.042410, -0.049417, -0.054782, -0.050388, -0.055383
#*# 	  -0.097913, -0.077179, -0.071080, -0.064727, -0.064464, -0.062941, -0.054977, -0.051782, -0.053343, -0.059035, -0.059442, -0.068061, -0.073813, -0.072895, -0.072488
#*# 	  -0.109252, -0.094790, -0.088648, -0.083599, -0.083041, -0.080205, -0.076453, -0.074365, -0.074761, -0.081318, -0.081992, -0.088159, -0.096125, -0.093242, -0.092507
#*# 	  -0.110058, -0.104261, -0.105976, -0.103265, -0.104818, -0.105069, -0.101488, -0.100556, -0.104492, -0.108582, -0.110099, -0.112146, -0.119397, -0.117214, -0.110846
#*# x_count = 15
#*# y_count = 15
#*# mesh_x_pps = 2
#*# mesh_y_pps = 2
#*# algo = bicubic
#*# tension = 0.2
#*# min_x = 10.0
#*# max_x = 210.0
#*# min_y = 10.0
#*# max_y = 210.0
#*#
#*# [beacon model default]
#*# model_coef = 1.4572772222241805,
#*# 	  1.792704245794235,
#*# 	  0.755681285373986,
#*# 	  0.38848973195746606,
#*# 	  0.40438056918119464,
#*# 	  0.18542219630070542,
#*# 	  -0.3637355018963045,
#*# 	  -0.05031761337562116,
#*# 	  0.3547090161183456,
#*# 	  0.09447002992238494
#*# model_domain = 3.1926727904449485e-07,3.33726395521764e-07
#*# model_range = 0.200000,5.000000
#*# model_temp = 42.208325
#*# model_offset = 0.15000
